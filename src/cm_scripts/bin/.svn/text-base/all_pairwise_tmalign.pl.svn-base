#!/usr/bin/perl

use strict;
use warnings;

use lib '/work/tex/src/cm_scripts/perl_lib';
use Getopt::Long;
use TMalign qw/ get_tmscore /;

my %options;
$options{native} = 0;
&GetOptions(
	\%options,
	'native=s',
);

my %scores;
foreach my $pdb1 (@ARGV) {
foreach my $pdb2 (@ARGV) {
	if ( $pdb1 lt $pdb2 ) {
		my $score = get_tmscore($pdb1,$pdb2);
		if ( !exists $scores{$pdb1} ) { $scores{$pdb1} = 0; }
		if ( !exists $scores{$pdb2} ) { $scores{$pdb2} = 0; }
		$scores{$pdb1} += $score;
		$scores{$pdb2} += $score;
	}
}
}

print join ' ', qw/ pdb avg_sim tmscore_native /;
print "\n";
foreach my $pdb ( sort { $scores{$a} <=> $scores{$b} } keys %scores ) {
	my $norm_score = $scores{$pdb} / scalar(keys %scores);
	my @output = ( $pdb, $norm_score );
	if ( -f $options{native} ) {
		push @output, get_tmscore($pdb,$options{native});
	}
	print join ' ', @output;
	print "\n";
}
