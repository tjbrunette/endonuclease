#!/usr/bin/perl

use strict;
use warnings;

use lib '/work/tex/src/cm_scripts/perl_lib';

use Getopt::Long;
use Rosetta::Util;
use Rosetta::Sequence;
use Rosetta::Job;
use File::Basename;

my %options;
$options{aln_dir}     = ".";
$options{date_cutoff} = "casp9";
&GetOptions(
	\%options,
	"aln_fn=s",              # alignment file
	"aln_fn_out=s",          # alignment file output
	"aln_dir=s",
	"date_cutoff=s",         # maximum date allowed for including a template
);
$options{date_cutoff} = process_date_cutoff( $options{date_cutoff} );

Rosetta::Sequence::filter_alns_by_date_job(
	$options{aln_fn}, $options{aln_fn_out}, $options{aln_dir}, $options{date_cutoff}, \%options
)->run_with_message("filtering alignments by date");

sub process_date_cutoff {
	my $date = shift;

	my $cutoff = $date;
	if ( $date eq 'casp6' ) {
		$cutoff = 20040501;
	} elsif ( $date eq 'casp7' ) {
		$cutoff = 20060501;
	} elsif ( $date eq 'casp8' ) {
		$cutoff = 20080501;
	} elsif ( $date eq 'casp9' ) {
		$cutoff = 20100425;
	}
	return $cutoff;
}
