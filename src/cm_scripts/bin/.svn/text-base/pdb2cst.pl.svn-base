#!/usr/bin/perl

use strict;
use warnings;

use lib '/work/tex/src/cm_scripts/perl_lib';

use Getopt::Long;
use CstUtil qw/ distances_from_pdb /;

my %options;
$options{sdev} = 2.0;
$options{dist_cutoff} = 10;
&GetOptions(
	\%options,
	"sdev=f",
	"dist_cutoff=f",
);

my $pdb = $ARGV[0];
if ( ! $pdb || !-f $pdb ) {
	die "usage: pdb2cst.pl -sdev=f -dist_cutoff=f $pdb";
}
my $distances = distances_from_pdb( $pdb );

foreach my $resi ( keys %$distances ) {
foreach my $resj ( keys %{ $distances->{$resi} } ) {
	my $dist = $distances->{$resi}{$resj};
	if ( $dist < $options{dist_cutoff} ) {
		print "AtomPair CA $resi CA $resj SOGFUNC 1 $dist $options{sdev} 1.0\n";
	}
}
}
