#!/usr/bin/perl -w

use strict;
use Getopt::Long;
use File::Basename;

$0 = basename $0;
my $fake = 0;
my $host = 'ws0.nrb';
&GetOptions(
	"fake"   => \$fake,
	"host=s" => \$host,
);
my $cmd = $ARGV[0];
my $usage = <<USAGE;
usage: $0 [options] cmd

cmd is executed in current working directory on a remove host.
If the cmd contains spaces, the command should be quoted like this:

	$0 'du -hs'

options are:
	-fake : stop short of executing cmd, but SSH and print cmd.
	-host <hostname> : execute the command explicitly on this host.
USAGE

if ( !$cmd || -z $cmd ) {
	die "Error: must provide a command!\n$usage\n";
}

my $pwd = $ENV{PWD};

if ( !$host) {
	$host = get_host();
}
my $ssh_cmd = "ssh $host 'cd $pwd; $cmd'";
print $ssh_cmd, "\n";
if ( !$fake ) {
	system( $ssh_cmd );
}
