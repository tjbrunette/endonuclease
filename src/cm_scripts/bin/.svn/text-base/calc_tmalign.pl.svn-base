#!/usr/bin/perl

use strict;
use warnings;

use lib '/work/tex/src/cm_scripts/perl_lib';
use Getopt::Long;
use TMalign qw/ get_tmscore /;

my %options;
$options{native} = 0;
&GetOptions(
	\%options,
	'native=s',
);

if ( !$options{native} ) {
	$options{native} = guess_native( $ENV{PWD} );
	if ( $options{native} =~ /(T\d{4})/ ) {
		my $id = $1;
		my $base_path = "/work/tex/casp9_benchmark/server_models/$id/";
		#push @ARGV, glob("/work/tex/casp9_benchmark/server_models/$id/HHpredA_TS1.pdb*");
		#push @ARGV, glob("/work/tex/casp9_benchmark/hhpred_rerun/$id.*");
		#push @ARGV, glob("/work/tex/casp9_benchmark/server_models/$id/RaptorX_TS1.pdb*");
		#push @ARGV, glob("/work/tex/casp9_benchmark/server_models/$id/BAKER-ROSETTASERVER_TS1.pdb");
		#push @ARGV, glob("/work/tex/casp9_benchmark/server_models/$id/Zhang-Server_TS1.pdb");
	}
}

foreach my $pdb (@ARGV) {
	print join ' ', ( $pdb, get_tmscore($pdb,$options{native}) );
	print "\n";
}


sub guess_native {
	my $dir = shift;

	if ( $dir !~ /(T\d{4})/ ) {
		die "Error: must provide native!\n";
	}

	my $id = $1;
	my $native = "/work/tex/casp9_benchmark/natives/$id.pdb";

	return $native;
}
