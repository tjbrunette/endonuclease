#! /usr/bin/env python

def parse(line):
    '''Parses a single line in psipred_ss2 format into its constituent parts'''
    cols = line.split()

    if len(cols) != 6:
        exit('Invalid format for line--', line)

    # Remove leading, trailing whitespace
    cols = [c.strip() for c in cols]

    # Type conversion
    residue = int(cols[0])
    amino_acid = cols[1]
    pred_ss = cols[2]
    p_coil, p_helix, p_sheet = [float(c) for c in cols[3:]]
    return residue, amino_acid, pred_ss, p_coil, p_helix, p_sheet

if __name__ == '__main__':
    '''Extracts the most likely secondary structure from a psipred_ss2 format file, writing the result to stdout'''
    import sys
    with open(sys.argv[1]) as file:
        predicted_ss = ''

        for line in file:
            line = line.strip()

            # Skip comments and blank lines
            if line.startswith('#') or not len(line):
                continue

            residue, amino_acid, ss, p_coil, p_helix, p_sheet = parse(line)
            predicted_ss += ss

        print predicted_ss
